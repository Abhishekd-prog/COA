# Input parameters
cache_size_kb = int(input("Enter size of Cache memory (in KB): "))
main_memory_size_mb = int(input("Enter size of Main memory (in MB): "))
cache_line_size = int(input("Enter size of each Cache Line (in Bytes): "))

# Convert to bytes
cache_size_bytes = cache_size_kb * 1024
main_memory_size_bytes = main_memory_size_mb * 1024 * 1024

# Compute number of cache lines and memory blocks
num_cache_lines = cache_size_bytes // cache_line_size
num_memory_blocks = main_memory_size_bytes // cache_line_size

# Calculate number of bits for cache line index
cache_line_bits = 0
temp = num_cache_lines
while temp > 1:
    cache_line_bits += 1
    temp //= 2

# Calculate number of bits for byte offset
byte_bits = 0
temp = cache_line_size
while temp > 1:
    byte_bits += 1
    temp //= 2

# Calculate total main memory address bits
main_address_bits = 0
temp = main_memory_size_bytes
while temp > 1:
    main_address_bits += 1
    temp //= 2

# Calculate number of tag bits
tag_bits = main_address_bits - (cache_line_bits + byte_bits)

# Display results
print(f"\nMain memory address = {main_address_bits} bits")

print("\nSelect cache mapping policy: Direct Mapping")
print("Number of cache banks = 1")
print(f"Hence, size of cache bank = {cache_size_kb} KB")

print(f"Cache lines per cache bank = {cache_size_bytes} / {cache_line_size} = {num_cache_lines} "
      f"(Line No-0 to Line No-{num_cache_lines - 1})")

print(f"Number of main memory blocks = {main_memory_size_bytes} / {cache_line_size} = {num_memory_blocks} "
      f"(Block No-0 to Block No-{num_memory_blocks - 1})")

print(f"\nMain memory address of {main_address_bits} bits is interpreted in 3 fields as calculated below:")
print(f"LSB {byte_bits} bits for Byte selection")
print(f"Middle {cache_line_bits} bits for Cache line selection")
print(f"MSB {tag_bits} bits (remaining) for the Tags")

# Mapping example
block_number = int(input("\nInput any Main memory block number for cache mapping: "))
cache_line_number = block_number % num_cache_lines
print(f"Block {block_number} is mapped into cache line number = {cache_line_number}")
